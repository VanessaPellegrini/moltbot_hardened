upstream moltbot_control {
    server 127.0.0.1:3000;  # Control plane address
}

server {
    listen 127.0.0.1:8080;
    server_name _;

    location /health/check {
        allow 127.0.0.1;
        deny all;
        proxy_pass http://moltbot_control/health;
    }

    default_type application/json;
    location / {
        return 503 '{"schema_version":"1.0","state":"HALF","reason":"RECOVERY","detected_at":"0000-00-00T00:00:00Z","actor":"system","message":"System in recovery mode","next_step":"Run verify, then open"}';
    }
}
