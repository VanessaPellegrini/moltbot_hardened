upstream moltbot_control {
    server 127.0.0.1:3000;  # Control plane address
}

server {
    listen 127.0.0.1:8080;
    server_name _;

    location /health/check {
        allow 127.0.0.1;
        deny all;
        proxy_pass http://moltbot_control/health;
    }

    default_type application/json;
    location / {
        return 503 '{"state":"HALF","message":"System in recovery mode","allowed":"127.0.0.1 /health/check only"}';
    }
}
